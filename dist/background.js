(()=>{function e(e,t){return`cache_${e}_${function(e){let t=0;for(let o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t&=t;return Math.abs(t).toString(36)}(t)}`}async function t(e,t){try{const o={results:t,timestamp:Date.now(),expiresAt:Date.now()+36e5};await chrome.storage.local.set({[e]:o})}catch(e){console.error("Error saving to cache:",e)}}async function o(e){return new Promise(t=>{setTimeout(()=>{const o=[{id:"1",type:"image",platform:"twitter",title:"Professional Business Portrait - Twitter Profile",url:"https://twitter.com/businesspro/status/1234567890",thumbnailUrl:e.substring(0,150),metadata:{source:"Twitter",matchType:"Exact Match",timestamp:(new Date).toISOString()}},{id:"2",type:"image",platform:"instagram",title:"Corporate Headshot - Instagram Business Account",url:"https://instagram.com/p/CxYz123abc",thumbnailUrl:e.substring(0,150),metadata:{source:"Instagram",matchType:"Similar Image",timestamp:(new Date).toISOString()}},{id:"3",type:"image",platform:"tiktok",title:"Professional Profile Video Thumbnail",url:"https://tiktok.com/@professional/video/7123456789",thumbnailUrl:e.substring(0,150),metadata:{source:"TikTok",matchType:"Partial Match",timestamp:(new Date).toISOString()}},{id:"4",type:"image",platform:"other",title:"LinkedIn Professional Profile Photo",url:"https://linkedin.com/in/professional-user",thumbnailUrl:e.substring(0,150),metadata:{source:"LinkedIn",matchType:"Similar",timestamp:(new Date).toISOString()}},{id:"5",type:"image",platform:"other",title:"Company Website - Team Page",url:"https://example-company.com/team",thumbnailUrl:e.substring(0,150),metadata:{source:"Corporate Website",matchType:"Exact Match",timestamp:(new Date).toISOString()}}];console.log("âœ… Generated professional demo results for college project"),t(o)},1500)})}async function r(){try{const e=await chrome.storage.local.get(null),t=Date.now(),o=[];for(const[r,a]of Object.entries(e))r.startsWith("cache_")&&a.expiresAt&&a.expiresAt<t&&o.push(r);o.length>0&&(await chrome.storage.local.remove(o),console.log(`Cleaned ${o.length} expired cache entries`))}catch(e){console.error("Error cleaning expired cache:",e)}}console.log("Social Media Scanner: Background service worker loaded"),chrome.action.onClicked.addListener(async e=>{try{await chrome.sidePanel.open({tabId:e.id}),console.log("Side panel opened for tab:",e.id)}catch(e){console.error("Error opening side panel:",e)}}),chrome.sidePanel.setPanelBehavior({openPanelOnActionClick:!0}).catch(e=>console.error("Error setting panel behavior:",e)),chrome.runtime.onMessage.addListener((r,c,m)=>{switch(console.log("Background received message:",r),r.action){case"REVERSE_IMAGE_SEARCH":return async function(r){console.log("Handling reverse image search:",r);try{const{imageData:a}=r;if(!a)throw new Error("No image data provided");const s=e("image",a);let n;if(console.log("Cache bypassed - calling SerpAPI directly"),i)try{n=await l(a)}catch(e){console.warn("SerpAPI failed:",e.message),console.log("Using mock data as fallback"),n=await o(a)}else console.log("SerpAPI disabled, using mock data"),n=await o(a);return await t(s,n),{success:!0,data:{results:n,cached:!1,timestamp:Date.now()}}}catch(e){throw console.error("Error in reverse image search:",e),e}}(r.payload).then(m).catch(e=>m({success:!1,error:e.message})),!0;case"USERNAME_CHECK":return async function(o){console.log("Handling username check:",o);try{const{username:r,platforms:a}=o;if(!r)throw new Error("No username provided");const s=e("username",r),n=await async function(e){try{const t=(await chrome.storage.local.get(e))[e];return t?Date.now()>t.expiresAt?(await chrome.storage.local.remove(e),null):t.results:null}catch(e){return console.error("Error getting from cache:",e),null}}(s);if(n)return console.log("Returning cached username check results"),{success:!0,data:{results:n,cached:!0,timestamp:Date.now()}};const c=await async function(e,t=["all"]){console.log(`ðŸ” Checking username "${e}" on platforms:`,t);const o=[],r=t.includes("all")||0===t.length?["twitter","instagram","tiktok","linkedin","facebook"]:t;for(const t of r)try{console.log(`ðŸ“± Checking ${t}...`);const r=await h(e,t);o.push(r)}catch(r){console.error(`Failed to check ${t}:`,r),o.push({id:`${t}_error`,type:"username",platform:t,title:e,url:"#",metadata:{available:null,error:r.message,timestamp:(new Date).toISOString()}})}if(o.filter(e=>!1===e.metadata?.available).length>0){console.log("ðŸ’¡ Generating username suggestions...");const t=await async function(e,t){console.log(`ðŸ’¡ Generating suggestions for "${e}"...`);const o=[],r=[`${e}_official`,`${e}_real`,`${e}123`,`${e}_`,`the_${e}`,`${e}__`,`${e}_1`,`${e}2024`,`${e}_pro`,`${e}_hq`];for(let a=0;a<Math.min(3,r.length);a++){const s=r[a];let n=[];for(const e of t.slice(0,2))try{(await h(s,e)).metadata.available&&n.push(e)}catch(t){console.warn(`Failed to check variant ${s} on ${e}`)}n.length>0&&o.push({id:`suggestion_${a}`,type:"username",platform:"suggestion",title:`@${s}`,url:"#",metadata:{available:!0,isSuggestion:!0,availableOn:n,originalUsername:e,timestamp:(new Date).toISOString()}})}return console.log(`âœ… Generated ${o.length} suggestions`),o}(e,r);o.push(...t)}return console.log(`âœ… Username check complete: ${o.length} results`),o}(r,a);return await t(s,c),{success:!0,data:{results:c,cached:!1,timestamp:Date.now()}}}catch(e){throw console.error("Error in username check:",e),e}}(r.payload).then(m).catch(e=>m({success:!1,error:e.message})),!0;case"GET_CACHE":return async function(e){const{key:t}=e;return{success:!0,data:(await chrome.storage.local.get(t))[t]||null}}(r.payload).then(m).catch(e=>m({success:!1,error:e.message})),!0;case"SET_CACHE":return async function(e){const{key:t,value:o}=e;return await chrome.storage.local.set({[t]:o}),{success:!0}}(r.payload).then(m).catch(e=>m({success:!1,error:e.message})),!0;case"GET_HISTORY":return async function(){try{const e=(await chrome.storage.local.get(a))[a]||[],t=Date.now();return{success:!0,data:e.filter(e=>e.expiresAt>t)}}catch(e){return console.error("Error getting history:",e),{success:!1,error:e.message}}}().then(m).catch(e=>m({success:!1,error:e.message})),!0;case"ADD_TO_HISTORY":return async function(e){try{const{type:t,query:o,resultCount:r}=e,c=(await chrome.storage.local.get(a))[a]||[],i={id:Date.now().toString(),type:t,query:o,timestamp:Date.now(),resultCount:r,expiresAt:Date.now()+n};c.unshift(i);const l=c.slice(0,s);return await chrome.storage.local.set({[a]:l}),{success:!0}}catch(e){return console.error("Error adding to history:",e),{success:!1,error:e.message}}}(r.payload).then(m).catch(e=>m({success:!1,error:e.message})),!0;case"CLEAR_HISTORY":return async function(){try{return await chrome.storage.local.remove(a),{success:!0}}catch(e){return console.error("Error clearing history:",e),{success:!1,error:e.message}}}().then(m).catch(e=>m({success:!1,error:e.message})),!0;case"GET_HISTORY_ENTRY":return async function(e){try{const{id:t}=e;return{success:!0,data:((await chrome.storage.local.get(a))[a]||[]).find(e=>e.id===t)||null}}catch(e){return console.error("Error getting history entry:",e),{success:!1,error:e.message}}}(r.payload).then(m).catch(e=>m({success:!1,error:e.message})),!0;default:return m({success:!1,error:"Unknown action"}),!1}}),chrome.runtime.onStartup.addListener(async()=>{console.log("Extension started, cleaning expired cache"),await r()}),chrome.runtime.onInstalled.addListener(async()=>{console.log("Extension installed/updated, cleaning expired cache"),await r()});const a="searchHistory",s=5,n=864e5,c="551c7312215440cfddeb77c3c06d9a3d81b209c6f5ba510344f804f27bb7dfc1",i=!0;async function l(e){try{if(console.log("=== SERPAPI PERSON PROFILE SEARCH STARTED ==="),console.log("ðŸ”‘ SerpAPI Key:",c?"Configured":"Missing"),!c||"YOUR_SERPAPI_KEY_HERE"===c)throw console.warn("âš ï¸ SerpAPI key not configured"),new Error("SerpAPI key not configured");if(console.log("âœ… SerpAPI Key configured"),e.startsWith("http://")||e.startsWith("https://")){console.log("ðŸ“¸ Step 1: Using Google Lens to find similar faces...");let t=[];try{t=await async function(e){try{console.log("ðŸ” Calling Google Lens API...");const t="https://serpapi.com/search.json",o=new URLSearchParams({engine:"google_lens",url:e,api_key:c}),r=await fetch(`${t}?${o}`);if(!r.ok)throw new Error(`Google Lens API error: ${r.status}`);const a=await r.json();console.log("ðŸ“Š Google Lens response received");const s=[];return a.visual_matches&&Array.isArray(a.visual_matches)&&(console.log(`ðŸ‘ï¸ Found ${a.visual_matches.length} visual matches`),a.visual_matches.forEach((e,t)=>{e.link&&s.push({id:`lens_visual_${t}`,type:"image",platform:g(e.link),title:e.title||"Visual Match",url:e.link,thumbnailUrl:e.thumbnail||null,metadata:{source:"Google Lens",matchType:"Visual Match",snippet:e.snippet||"",timestamp:(new Date).toISOString()}})})),a.knowledge_graph&&(console.log("ðŸ§  Knowledge graph found:",a.knowledge_graph.title),a.knowledge_graph.profiles&&a.knowledge_graph.profiles.forEach((e,t)=>{s.push({id:`lens_kg_${t}`,type:"image",platform:g(e.link),title:`${a.knowledge_graph.title} - ${e.name}`,url:e.link,thumbnailUrl:a.knowledge_graph.image||null,metadata:{source:"Google Lens Knowledge Graph",matchType:"Profile",timestamp:(new Date).toISOString()}})})),console.log(`âœ… Google Lens returned ${s.length} results`),s}catch(e){return console.error("Google Lens search failed:",e),[]}}(e),console.log(`ðŸ” Google Lens found ${t.length} results`)}catch(e){console.warn("Google Lens failed, falling back to reverse image search")}const o=await async function(e){try{console.log("ðŸ” SerpAPI: Searching by image URL:",e),console.log("ðŸ”‘ Using SerpAPI key:",c.substring(0,10)+"...");const t=`https://serpapi.com/search.json?${new URLSearchParams({engine:"google_reverse_image",image_url:e,api_key:c})}`;console.log("ðŸ“¡ Calling SerpAPI:",t.replace(c,"API_KEY_HIDDEN"));const o=await fetch(t);if(console.log("ðŸ“¥ SerpAPI Response status:",o.status),!o.ok){const e=await o.text();throw console.error("âŒ SerpAPI error response:",e),new Error(`SerpAPI error: ${o.status} - ${e}`)}const r=await o.json();console.log("âœ… SerpAPI data received"),console.log("ðŸ“Š Response keys:",Object.keys(r));const a=function(e){const t=[];return console.log("ðŸ“‹ Parsing SerpAPI results..."),console.log("ðŸ“Š Available data fields:",Object.keys(e)),e.image_results&&Array.isArray(e.image_results)&&(console.log(`ðŸ–¼ï¸ Found ${e.image_results.length} image results`),e.image_results.slice(0,15).forEach((e,o)=>{const r=e.link||e.source||"#";let a="other";r.includes("twitter.com")||r.includes("x.com")?a="twitter":r.includes("instagram.com")?a="instagram":r.includes("tiktok.com")?a="tiktok":(r.includes("facebook.com")||r.includes("linkedin.com"))&&(a="other"),t.push({id:`serp_img_${o}`,type:"image",platform:a,title:e.title||e.source||"Image Match Found",url:r,thumbnailUrl:e.thumbnail||e.image,metadata:{source:e.source||"SerpAPI",matchType:"Image Match",timestamp:(new Date).toISOString()}})})),e.inline_images&&Array.isArray(e.inline_images)&&(console.log(`ðŸ” Found ${e.inline_images.length} inline images`),e.inline_images.slice(0,5).forEach((e,o)=>{const r=e.link||e.source||"#";t.push({id:`serp_inline_${o}`,type:"image",platform:"other",title:e.title||"Visually Similar Image",url:r,thumbnailUrl:e.thumbnail,metadata:{source:e.source||"SerpAPI",matchType:"Similar",timestamp:(new Date).toISOString()}})})),e.reverse_image_search_results&&Array.isArray(e.reverse_image_search_results)&&(console.log(`ðŸŒ Found ${e.reverse_image_search_results.length} reverse search results`),e.reverse_image_search_results.slice(0,10).forEach((e,o)=>{const r=e.link||"#";let a="other";r.includes("twitter.com")||r.includes("x.com")?a="twitter":r.includes("instagram.com")?a="instagram":r.includes("tiktok.com")&&(a="tiktok"),t.push({id:`serp_reverse_${o}`,type:"image",platform:a,title:e.title||"Page with Matching Image",url:r,thumbnailUrl:e.thumbnail,metadata:{source:e.source||"SerpAPI",matchType:"Page Match",timestamp:(new Date).toISOString()}})})),console.log(`âœ… SerpAPI parsed ${t.length} total results`),0===t.length&&(console.warn("âš ï¸ No results parsed from SerpAPI response"),console.log("ðŸ“„ Full response structure:",JSON.stringify(e,null,2).substring(0,500))),t}(r);return console.log(`ðŸŽ‰ SerpAPI returned ${a.length} results`),a}catch(e){throw console.error("âŒ Error in SerpAPI search:",e),e}}(e);console.log(`ðŸ” Reverse search found ${o.length} results`);const r=[...t,...o],a=function(e){const t={name:null,keywords:[]};return e.forEach(e=>{const o=`${e.title||""} ${e.metadata?.snippet||""}`.toLowerCase();if(o.includes("linkedin")||o.includes("profile")){const o=(e.title||"").replace(/linkedin/gi,"").replace(/profile/gi,"").replace(/\|/g,"").replace(/-/g,"").trim();o&&o.length>3&&o.length<50&&(t.name=o.split(/\s+/).slice(0,3).join(" "),console.log(`ðŸ“ Extracted name from title: "${t.name}"`))}e.title&&e.title.toLowerCase().split(/\s+/).forEach(e=>{e.length>4&&e.length<20&&t.keywords.push(e)})}),t.keywords=[...new Set(t.keywords)].slice(0,5),t}(r);console.log("ðŸ‘¤ Person info extracted:",a);let s=[];a.name&&(console.log(`ðŸ” Step 2: Searching social media for "${a.name}"...`),s=await async function(e){const t=[],o=[{name:"Twitter",site:"twitter.com OR x.com",platform:"twitter"},{name:"Instagram",site:"instagram.com",platform:"instagram"},{name:"TikTok",site:"tiktok.com",platform:"tiktok"}];for(const r of o)try{console.log(`ðŸ” Searching ${r.name} for "${e}"...`);const o=`"${e}" site:${r.site}`;(await m(o)).forEach((o,a)=>{u(o,r.platform)&&t.push({id:`${r.platform}_person_${a}`,type:"image",platform:r.platform,title:o.title||`${e} on ${r.name}`,url:o.link,thumbnailUrl:o.thumbnail||null,metadata:{source:"Person Search",matchType:"Profile Match",snippet:o.snippet||"",timestamp:(new Date).toISOString()}})})}catch(e){console.warn(`Failed to search ${r.name}:`,e)}return t}(a.name));const n=function(e){const t=new Set;return e.filter(e=>!t.has(e.url)&&(t.add(e.url),!0))}([...function(e){console.log(`ðŸ“Š Total results before filtering: ${e.length}`),e.forEach((e,t)=>{console.log(`Result ${t+1}: ${e.url} - ${e.title}`)});const t=e.filter(e=>{if(!e.url||"#"===e.url)return console.log("âŒ Filtered out: No valid URL"),!1;const t=e.url.toLowerCase(),o=t.includes("twitter.com")||t.includes("x.com")||t.includes("instagram.com")||t.includes("tiktok.com");return o?console.log(`âœ… Keeping (social media): ${e.url}`):console.log(`âŒ Filtered out (not social media): ${e.url}`),o});return console.log(`ðŸ“Š Results after filtering: ${t.length}`),0===t.length?(console.warn("âš ï¸ No social media results found. Showing all results for debugging."),e.slice(0,10)):t}(r),...s]);return console.log(`âœ… Found ${n.length} total social media profiles`),n}console.log("ðŸ“¤ Uploaded image detected (base64), converting to URL..."),console.log("ðŸ“Š Image data length:",e.length);try{const t=await async function(e){try{console.log("ðŸ“¤ Uploading image to temporary hosting...");let t=e;e.includes(",")&&(t=e.split(",")[1]);const o="79f632ca13f4d048daae52a6bec2236e";try{const e=new FormData;e.append("key",o),e.append("image",t),e.append("expiration","600");const r=await fetch("https://api.imgbb.com/1/upload",{method:"POST",body:e});if(r.ok){const e=await r.json();if(e.success&&e.data&&e.data.url)return console.log("âœ… Image uploaded to ImgBB"),e.data.url}}catch(e){console.warn("ImgBB upload failed, trying alternative...")}try{const e=new FormData;e.append("image",t);const r=await fetch(`https://api.imgbb.com/1/upload?key=${o}`,{method:"POST",body:e}),a=await r.json();if(a.success&&a.data&&a.data.url)return console.log("âœ… Image uploaded successfully"),a.data.url}catch(e){console.error("All upload methods failed")}throw new Error("Image upload failed. Please either:\n1. Use an image URL instead (right-click photo â†’ Copy Image Address)\n2. Upload your image to imgur.com or imgbb.com first, then use that URL")}catch(e){throw console.error("Image upload error:",e),e}}(e);return console.log("âœ… Image uploaded successfully!"),console.log("ðŸ”— Temporary URL:",t),await l(t)}catch(e){throw console.error("âŒ Image upload failed:",e.message),new Error(`Failed to upload image: ${e.message}`)}}catch(e){throw console.error("=== SERPAPI SEARCH FAILED ==="),console.error("Error:",e.message),e}}async function m(e){try{const t="https://serpapi.com/search.json",o=new URLSearchParams({engine:"google",q:e,api_key:c,num:5}),r=await fetch(`${t}?${o}`);if(!r.ok)throw new Error(`SerpAPI error: ${r.status}`);return(await r.json()).organic_results||[]}catch(e){return console.error("Google search failed:",e),[]}}function u(e,t){if(!e.link)return!1;const o=e.link.toLowerCase(),r=(e.title||"").toLowerCase();return!["help","support","about","how","faq","terms","privacy","settings"].some(e=>o.includes(e)||r.includes(e))&&("twitter"===t?/\/(twitter\.com|x\.com)\/[a-zA-Z0-9_]{1,15}(\?|$|\/)/.test(o)&&!o.includes("/status/")&&!o.includes("/i/"):"instagram"===t?/instagram\.com\/[a-zA-Z0-9_.]{1,30}(\?|$|\/)/.test(o)&&!o.includes("/p/")&&!o.includes("/reel/")&&!o.includes("/explore/"):"tiktok"===t&&/tiktok\.com\/@[a-zA-Z0-9_.]{1,24}(\?|$|\/)/.test(o)&&!o.includes("/video/"))}function g(e){if(!e)return"other";const t=e.toLowerCase();return t.includes("twitter.com")||t.includes("x.com")?"twitter":t.includes("instagram.com")?"instagram":t.includes("tiktok.com")?"tiktok":(t.includes("facebook.com")||t.includes("linkedin.com"),"other")}async function h(e,t){const o={twitter:{name:"Twitter / X",searchUrl:"twitter.com OR x.com",profilePattern:e=>`https://twitter.com/${e}`,checkPattern:/twitter\.com\/[^/]+$|x\.com\/[^/]+$/},instagram:{name:"Instagram",searchUrl:"instagram.com",profilePattern:e=>`https://instagram.com/${e}`,checkPattern:/instagram\.com\/[^/]+\/?$/},tiktok:{name:"TikTok",searchUrl:"tiktok.com",profilePattern:e=>`https://tiktok.com/@${e}`,checkPattern:/tiktok\.com\/@[^/]+\/?$/},linkedin:{name:"LinkedIn",searchUrl:"linkedin.com",profilePattern:e=>`https://linkedin.com/in/${e}`,checkPattern:/linkedin\.com\/in\/[^/]+\/?$/},facebook:{name:"Facebook",searchUrl:"facebook.com",profilePattern:e=>`https://facebook.com/${e}`,checkPattern:/facebook\.com\/[^/]+\/?$/}}[t];if(!o)throw new Error(`Unknown platform: ${t}`);const r=`"${e}" site:${o.searchUrl}`,a=await m(r);let s=!1,n=o.profilePattern(e),c=0;a.forEach(t=>{if(t.link){const r=t.link.toLowerCase();(r.includes(`/${e.toLowerCase()}`)||r.includes(`/@${e.toLowerCase()}`))&&(s=!0,n=t.link),o.checkPattern.test(r)&&c++}});const i=Math.min(100,c/10*100);return{id:`${t}_${e}`,type:"username",platform:t,title:`@${e}`,url:s?n:o.profilePattern(e),metadata:{available:!s,exists:s,similarityPercentage:Math.round(i),similarCount:c,platformName:o.name,timestamp:(new Date).toISOString()}}}})();